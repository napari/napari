# Organization of Documentation for napari

The organization of documentation for the napari project is currently split into
three repositories: 

- the [`napari/napari`] repo, which houses the source code for napari;
- the [`napari/docs`] repo which contains legacy and version-specific API
documentation and guides; and
- the [`napari/napari.github.io`] repo that makes up the main [napari.org] site,
comprising of tutorials and copied-over files from the [`napari/napari`] repo.

## Location of documentation sources

API docs, guides, plugins, roadmaps, releases, developer guides, developer
resources, how-to guides and community resources live in the [`napari/napari`]
repo under the `docs` directory. For backwards compatibility with the previous
structure as used in [`napari/docs`], some files are "duplicated" by using the
[MyST `include` directive](https://myst-parser.readthedocs.io/en/latest/sphinx/use.html#include-a-file-from-outside-the-docs-folder-like-readme-md).

Tutorials, the main index page, and the napari sphinx theme are in the
[`napari/napari.github.io`] repo.

The [`napari/docs`] repo contains no original documentation sources.

## Bringing it all together

For the [`napari/docs`] repo, files are built in `docs/_build/html` in the main
[`napari/napari`] repo and then copied over to the appropriate version number or
`dev` using an automated process.

Documentation sources are copied over to `napari.github.io` using the
`copy-docs.py` script (found in the `docs` directory of [`napari/napari`]).
Duplicate files are excluded and the table of contents is automatically updated.
Specifying which files should be copied / excluded can be modified in the script
itself. This script is automatically run in continuous integration and the
changes are pushed to the [`napari/napari.github.io`] repo, which will then
automatically build and update the site.

## Making changes to the documentation

For any changes in documentation (except the tutorials), a PR should be
submitted to the [`napari/napari`] repo. When a new file is added to this repo
under the current `docs` folder structure, it will automatically be copied over
to [`napari/napari.github.io`] and the [napari.org] table of contents will be
automatically updated. If the changes are made directly to
[`napari/napari.github.io`], they will be overwritten when a new PR is merged to
[`napari/napari`].

If any autogenerated documentation sources are added to [`napari/napari`] (such
as, for example, the Preferences documentation), they will need to also be added
to [`napari/napari.github.io`] and to the list of documentation sources to be
copied over by the `copy-docs.py` script.

## Building and testing documentation and the napari.org website locally

If you want to check that your documentation changes are rendered correctly,
you will need to check them using the theme from the [`napari/napari.github.io`]
repository.

### 1. Clone both repos

In order to see the changes exactly as they will appear in [napari.org], you
need to clone both the [`napari/napari`] and the [`napari/napari.github.io`]
repos. 

### 2. Build the documentation for napari locally

In the root folder of your local clone of `napari/napari`, after your changes
are made, run

```sh
$ make docs
```

This will generate all the API documentation for napari and render the how-tos,
developer resources and in-depth explanations as html documents. Make sure you
check that any new documents are added to the table of contents under
`docs/_toc.yml` and, if necessary, that they are added to the list of files to
be copied by the `copy-docs.py` script.

### 3. Copy the documentation sources to the local clone of [`napari/napari.github.io`]

In the root folder of your local clone of `napari/napari`, run

```sh
$ python docs/copy-docs.py <dest-dir>
```

where `<dest-dir>` should be replaced by the path to your local clone of
[`napari/napari.github.io`]

This will copy the documentation sources to the appropriate location for
building, so you can verify that they will show up and be rendered correctly in
the [napari.org] website after your PR is merged.

```{warning}
This will overwrite any changes you might have made to the local clone of
[`napari/napari.github.io`].
```

### 4. Build the website locally and verify your changes

Go to the root folder of your local clone of the [`napari/napari.github.io`]
repo and follow the
[steps outlined in the `README.md` file](https://github.com/napari/napari.github.io/#readme):

1. Run `pip install -r requirements.txt`
2. Install and setup Node.js and Yarn if you haven't already
3. Run `yarn dev` to build and enable a custom development server that can be
   then accessed at `http://localhost:8080`

[`napari/napari`]: https://github.com/napari/napari
[`napari/docs`]: https://github.com/napari/docs
[`napari/napari.github.io`]: https://github.com/napari/napari.github.io
[napari.org]: https://napari.org
