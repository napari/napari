name: Remove "ready to merge" label

on:
  push:
    branches:
      - main
  schedule:
    - cron: "6 6 * * *" #Â every morning

permissions:
  pull-requests: write

jobs:
  remove_label:
    runs-on: ubuntu-latest
    steps:
      - name: Remove label
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea # v7.0.1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { data: issues } = await github.rest.issues.listForRepo({
              ...context.repo,
              state: 'closed',
              per_page: 100,
              sort: 'updated',
              direction: 'desc',
              labels: 'ready to merge',
            });
            if (issues.length > 0) {
              console.log('Found the following closed items with the "ready to merge" label:');
              for (const issue of issues) {
                console.log(`- #${issue.number}: ${issue.title}`);
                try {
                  await github.rest.issues.removeLabel({
                    ...context.repo,
                    issue_number: issue.number,
                    name: 'ready to merge'
                  });
                  console.log(`  > Removed 'ready to merge' label from #${issue.number}`);
                } catch (error) {
                  console.error(`  > Failed to remove label from #${issue.number}: ${error.message}`);
                }
              }
            } else {
              console.log('No closed items found with the "ready to merge" label.');
            }
